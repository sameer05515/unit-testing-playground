<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdown Explorer - Alpine.js</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <div id="app" x-data="markdownExplorer()" x-init="init()">
      <div class="min-vh-100 d-flex flex-column">
        <!-- Header -->
        <header
          x-show="activeFile"
          class="border-bottom border-secondary px-4 py-3 bg-dark text-light"
        >
          <div class="d-flex flex-column flex-lg-row gap-3 align-items-lg-center justify-content-lg-between">
            <div>
              <p class="text-uppercase text-muted small mb-1">File</p>
              <h1 class="h3 fw-semibold mb-1" x-text="activeFile?.name"></h1>
              <small class="text-muted" x-text="activeFile?.relativePath"></small>
            </div>
            <button
              class="btn btn-outline-info btn-sm align-self-start align-self-lg-center"
              @click="refreshFiles()"
              type="button"
              :disabled="loading"
            >
              <span x-show="!loading">Refresh list</span>
              <span x-show="loading" class="spinner-border spinner-border-sm" role="status"></span>
            </button>
          </div>
        </header>

        <!-- Main Content -->
        <div class="flex-grow-1 d-flex overflow-hidden">
          <!-- Sidebar -->
          <aside
            class="border-end border-secondary bg-dark text-light overflow-auto"
            style="width: 320px; min-width: 280px;"
            x-show="sidebarOpen"
            x-transition
          >
            <div class="p-3">
              <div class="mb-3">
                <label class="form-label text-uppercase text-muted small">Quick filter</label>
                <input
                  type="search"
                  class="form-control form-control-sm bg-dark border-secondary text-light"
                  placeholder="Type to filter..."
                  x-model="filter"
                />
              </div>

              <div
                class="list-group list-group-flush"
                style="max-height: calc(100vh - 120px); overflow-y: auto;"
              >
                <template x-for="file in filteredFiles" :key="file.slug">
                  <button
                    type="button"
                    class="list-group-item list-group-item-action bg-dark border-secondary text-light"
                    :class="{ 'active': activeFile?.slug === file.slug }"
                    :data-slug="file.slug"
                    @click="selectFile(file.slug)"
                  >
                    <p class="fw-semibold mb-1" x-text="file.name"></p>
                    <small class="text-muted d-block text-truncate" x-text="file.relativePath"></small>
                  </button>
                </template>
                <div
                  x-show="filteredFiles.length === 0"
                  class="list-group-item bg-dark border-secondary text-muted text-center py-4"
                >
                  No files match your filter
                </div>
                <div
                  x-show="files.length === 0 && !loading"
                  class="list-group-item bg-dark border-secondary text-muted text-center py-4"
                >
                  No markdown files found
                </div>
              </div>
            </div>
          </aside>

          <!-- Content Area -->
          <main class="flex-grow-1 d-flex flex-column overflow-hidden">
            <!-- Empty State -->
            <div
              x-show="!activeFile && files.length > 0"
              class="flex-grow-1 d-flex align-items-center justify-content-center text-muted"
            >
              <div class="text-center">
                <p class="mb-3">Select a file from the sidebar to view</p>
                <button
                  class="btn btn-outline-light btn-sm"
                  @click="sidebarOpen = true"
                  type="button"
                >
                  Show sidebar
                </button>
              </div>
            </div>

            <!-- Loading State -->
            <div
              x-show="loading && files.length === 0"
              class="flex-grow-1 d-flex align-items-center justify-content-center"
            >
              <div class="text-center">
                <div class="spinner-border text-primary mb-3" role="status"></div>
                <p class="text-muted">Loading markdown files...</p>
              </div>
            </div>

            <!-- Error State -->
            <div
              x-show="error && !loading"
              class="flex-grow-1 d-flex align-items-center justify-content-center"
            >
              <div class="alert alert-danger mx-4" style="max-width: 600px;" role="alert">
                <h5 class="alert-heading">Error</h5>
                <p class="mb-2" x-text="error"></p>
                <p class="small text-muted mb-3">
                  Make sure the backend server is running on <code>http://localhost:3030</code>
                </p>
                <hr />
                <div class="d-flex gap-2">
                  <button class="btn btn-outline-danger btn-sm" @click="refreshFiles()" type="button">
                    Retry
                  </button>
                  <button class="btn btn-outline-secondary btn-sm" @click="error = null" type="button">
                    Dismiss
                  </button>
                </div>
              </div>
            </div>

            <!-- Markdown Viewer -->
            <div
              x-show="activeFile && !loading"
              class="flex-grow-1 overflow-auto p-4 bg-dark text-light"
            >
              <div
                class="markdown-content"
                x-html="renderedContent"
              ></div>
            </div>
          </main>
        </div>

        <!-- Footer -->
        <footer
          x-show="activeFile"
          class="border-top border-secondary px-4 py-3 bg-dark text-light"
        >
          <div class="d-flex flex-column flex-lg-row gap-3 align-items-lg-center justify-content-between">
            <div>
              <p class="text-uppercase text-muted small mb-1">Position</p>
              <span class="fw-semibold">
                <span x-text="(activeFile?.index || 0) + 1"></span> / <span x-text="files.length"></span>
              </span>
            </div>
            <div class="btn-group" role="group" aria-label="File navigation">
              <button
                class="btn btn-outline-light btn-sm"
                @click="navigatePrev()"
                type="button"
              >
                ‹ Prev
              </button>
              <button
                class="btn btn-outline-light btn-sm"
                @click="navigateNext()"
                type="button"
              >
                Next ›
              </button>
            </div>
            <div class="text-muted small text-center text-lg-end">
              API: <code>/api/files</code> • <code>/api/files/{slug}</code>
            </div>
          </div>
        </footer>
      </div>
    </div>

    <script
      defer
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>


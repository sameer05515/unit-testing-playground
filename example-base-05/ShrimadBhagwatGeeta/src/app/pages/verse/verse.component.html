<section class="verse-page py-4">
  <div class="container" *ngIf="viewModel$ | async as vm; else loading">
    <ng-container *ngIf="vm; else notFound">
      <div class="row g-4">
        <div class="col-12">
          <div class="verse-header p-4 rounded text-white">
            <div class="d-flex flex-column flex-lg-row justify-content-between gap-3 align-items-lg-center">
              <div>
                <p class="text-uppercase small text-white-50 mb-1">
                  {{ vm.chapterTitle }}
                </p>
                <h1 class="h2 mb-0">{{ vm.verse.verseHeader }}</h1>
              </div>
              <div class="d-flex flex-wrap gap-2">
                <a [routerLink]="['/chapter', vm.chapterId]" class="btn btn-outline-light btn-sm">
                  <span class="icon-inline" aria-hidden="true">‚Ü©Ô∏è</span>
                  <span class="ms-1" i18n="@@verseBackToChapterCta">Back to Chapter</span>
                </a>
                <a
                  *ngIf="vm.verse.previousVerseRoute"
                  [routerLink]="vm.verse.previousVerseRoute"
                  class="btn btn-light btn-sm"
                >
                  <span class="icon-inline" aria-hidden="true">‚óÄÔ∏è</span>
                  <span class="ms-1" i18n="@@versePreviousCta">Previous</span>
                </a>
                <a
                  *ngIf="vm.verse.nextVerseRoute"
                  [routerLink]="vm.verse.nextVerseRoute"
                  class="btn btn-light btn-sm"
                >
                  <span class="icon-inline" aria-hidden="true">‚ñ∂Ô∏è</span>
                  <span class="ms-1" i18n="@@verseNextCta">Next</span>
                </a>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <h2 class="h5 text-primary fw-semibold mb-3">‡§∂‡•ç‡§≤‡•ã‡§ï</h2>
              <div class="verse-block mb-4">
                <div *ngFor="let line of vm.verse.shlok" class="sanskrit-line">
                  {{ line.value }}
                </div>
              </div>
              <h2 class="h5 text-primary fw-semibold mb-3">Transliteration</h2>
              <div class="verse-block">
                <div *ngFor="let line of vm.verse.shlokEng" class="transliteration-line">
                  {{ line.value }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body d-flex flex-column gap-4">
              <div>
                <h2 class="h5 text-primary fw-semibold mb-3" i18n="@@verseAudioHeading">Audio Recitation</h2>
                <div class="audio-wrapper">
                  <audio
                    controls
                    controlsList="nodownload"
                    [attr.loop]="loopEnabled() ? '' : null"
                    [src]="audioSource(vm.verse)"
                  >
                    Your browser does not support the HTML5 Audio element.
                  </audio>
                </div>
                <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="toggleLoop()">
                  <ng-container *ngIf="loopEnabled(); else enableLoopLabel">
                    <span class="icon-inline" aria-hidden="true">‚èπÔ∏è</span>
                    <span class="ms-1" i18n="@@verseDisableLoop">Disable loop</span>
                  </ng-container>
                  <ng-template #enableLoopLabel>
                    <span class="icon-inline" aria-hidden="true">üîÅ</span>
                    <span class="ms-1" i18n="@@verseEnableLoop">Enable loop</span>
                  </ng-template>
                </button>
              </div>

              <div *ngIf="vm.verse.meaning.length">
                <h2 class="h5 text-primary fw-semibold mb-3" i18n="@@verseMeaningHeading">Meaning</h2>
                <div>
                  <ng-container *ngFor="let meaning of vm.verse.meaning; let last = last">
                    <a
                      *ngIf="meaning.wordMeaningDetailRoute; else plainMeaning"
                      [routerLink]="meaning.wordMeaningDetailRoute"
                      class="fw-semibold"
                    >
                      {{ meaning.sanskrit }}
                    </a>
                    <ng-template #plainMeaning>
                      <span class="fw-semibold">{{ meaning.sanskrit }}</span>
                    </ng-template>
                    <span>‚Äî {{ meaning.meaning }}</span>
                    <span *ngIf="!last">, </span>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="vm.verse.translation.length">
                <h2 class="h5 text-primary fw-semibold mb-3" i18n="@@verseTranslationHeading">Translation</h2>
                <ul class="list-unstyled mb-0">
                  <li *ngFor="let translation of vm.verse.translation" class="mb-2">
                    <span class="fw-semibold text-body">{{ translation.header }}</span>
                    <span class="text-body-secondary"> ‚Äî {{ translation.value }}</span>
                  </li>
                </ul>
              </div>

              <div *ngIf="vm.verse.commentary.length">
                <h2 class="h5 text-primary fw-semibold mb-3" i18n="@@verseCommentaryHeading">Commentary</h2>
                <div class="commentary-block">
                  <div
                    *ngFor="let line of vm.verse.commentary"
                    [class.commentary-highlight]="line.isShlokCommentary"
                    class="mb-3"
                  >
                    {{ line.value }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</section>

<ng-template #loading>
  <div class="d-flex justify-content-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden" i18n="@@verseLoadingLabel">Loading verse‚Ä¶</span>
    </div>
  </div>
</ng-template>

<ng-template #notFound>
  <section class="py-5">
    <div class="container">
      <div class="alert alert-warning" role="alert">
        <span i18n="@@verseMissingMessage">Requested verse could not be found. Return to the</span>
        <a routerLink="/" class="alert-link" i18n="@@verseMissingHomeLink">home page</a>.
      </div>
    </div>
  </section>
</ng-template>


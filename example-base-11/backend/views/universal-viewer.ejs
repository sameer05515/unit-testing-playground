<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= file.name %> - Universal Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #000;
            color: #fff;
            overflow: hidden;
        }
        .viewer-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .viewer-header {
            background-color: rgba(0, 0, 0, 0.8);
            padding: 1rem;
            border-bottom: 1px solid #333;
            z-index: 1000;
        }
        .viewer-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
            position: relative;
        }
        .viewer-content img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .viewer-content video {
            max-width: 100%;
            max-height: 100%;
        }
        .viewer-content audio {
            width: 80%;
            max-width: 600px;
        }
        .viewer-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .file-info {
            font-size: 0.9rem;
            color: #aaa;
        }
        .nav-buttons {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1001;
        }
        .nav-buttons .btn {
            padding: 1rem 1.5rem;
            font-size: 1.5rem;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        .nav-buttons .btn:hover {
            opacity: 1;
        }
        .nav-prev {
            left: 1rem;
        }
        .nav-next {
            right: 1rem;
        }
        .file-not-found {
            text-align: center;
            padding: 2rem;
        }
        .controls-overlay {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            z-index: 1002;
        }
        .badge-type-image {
            background-color: #ffc107;
            color: #000;
        }
        .badge-type-video {
            background-color: #dc3545;
        }
        .badge-type-song {
            background-color: #0d6efd;
        }
        .badge-type-pdf {
            background-color: #198754;
        }
    </style>
</head>
<body>
    <div class="viewer-container">
        <!-- Header -->
        <div class="viewer-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0">
                        <% 
                        const typeIcons = {
                            'image': 'image',
                            'video': 'play-circle',
                            'song': 'music-note-beamed',
                            'pdf': 'file-earmark-pdf'
                        };
                        const icon = typeIcons[file.extensionType] || 'file';
                        %>
                        <i class="bi bi-<%= icon %>"></i>
                        <%= file.name %>
                    </h5>
                    <div class="file-info">
                        <span class="badge badge-type-<%= file.extensionType %>"><%= file.extensionType %></span>
                        <span class="ms-2"><%= file.sizeFormatted %></span>
                        <span class="ms-2"><%= file.extension %></span>
                    </div>
                </div>
                <div>
                    <button class="btn btn-outline-light btn-sm" onclick="window.close()" title="Close">
                        <i class="bi bi-x-lg"></i> Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <% if (navigation.prev || navigation.next) { %>
        <div class="nav-buttons">
            <% if (navigation.prev) { %>
            <a href="/viewer/<%= navigation.prev.slug %>" class="btn btn-primary nav-prev" title="Previous: <%= navigation.prev.name %>">
                <i class="bi bi-chevron-left"></i>
            </a>
            <% } %>
            <% if (navigation.next) { %>
            <a href="/viewer/<%= navigation.next.slug %>" class="btn btn-primary nav-next" title="Next: <%= navigation.next.name %>">
                <i class="bi bi-chevron-right"></i>
            </a>
            <% } %>
        </div>
        <% } %>

        <!-- Content Area -->
        <div class="viewer-content">
            <% if (file.extensionType === 'image') { %>
                <!-- Image Viewer -->
                <img src="/file/<%= file.slug %>" alt="<%= file.name %>" id="mediaContent">
            <% } else if (file.extensionType === 'video') { %>
                <!-- Video Viewer -->
                <video controls autoplay id="mediaContent">
                    <source src="/file/<%= file.slug %>" type="video/<%= file.extension === '.mp4' ? 'mp4' : 'x-flv' %>">
                    Your browser does not support the video tag.
                </video>
            <% } else if (file.extensionType === 'song') { %>
                <!-- Audio Player -->
                <div class="w-100 text-center">
                    <audio controls autoplay id="mediaContent">
                        <source src="/file/<%= file.slug %>" type="audio/mpeg">
                        Your browser does not support the audio tag.
                    </audio>
                    <div class="mt-3">
                        <h4><%= file.name %></h4>
                        <p class="text-muted"><%= file.sizeFormatted %></p>
                    </div>
                </div>
            <% } else if (file.extensionType === 'pdf') { %>
                <!-- PDF Viewer -->
                <iframe src="/file/<%= file.slug %>" id="mediaContent"></iframe>
            <% } else { %>
                <!-- Unsupported Type -->
                <div class="file-not-found">
                    <i class="bi bi-file-earmark-x" style="font-size: 4rem;"></i>
                    <h3>Unsupported File Type</h3>
                    <p>This file type cannot be previewed in the browser.</p>
                    <p class="text-muted">File: <%= file.name %></p>
                    <p class="text-muted">Path: <%= file.path %></p>
                </div>
            <% } %>
        </div>

        <!-- Controls Overlay (for videos) -->
        <% if (file.extensionType === 'video') { %>
        <div class="controls-overlay">
            <div class="btn-group" role="group">
                <button class="btn btn-sm btn-outline-light" onclick="toggleFullscreen()" title="Fullscreen">
                    <i class="bi bi-arrows-fullscreen"></i>
                </button>
                <button class="btn btn-sm btn-outline-light" onclick="downloadFile()" title="Download">
                    <i class="bi bi-download"></i>
                </button>
            </div>
        </div>
        <% } %>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            <% if (navigation.prev) { %>
            if (e.key === 'ArrowLeft') {
                window.location.href = '/viewer/<%= navigation.prev.slug %>';
            }
            <% } %>
            <% if (navigation.next) { %>
            if (e.key === 'ArrowRight') {
                window.location.href = '/viewer/<%= navigation.next.slug %>';
            }
            <% } %>
            if (e.key === 'Escape') {
                window.close();
            }
        });

        // Fullscreen toggle
        function toggleFullscreen() {
            const element = document.getElementById('mediaContent');
            if (!document.fullscreenElement) {
                element.requestFullscreen().catch(err => {
                    console.error('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Download file
        function downloadFile() {
            window.location.href = '/file/<%= file.slug %>?download=true';
        }

        // Auto-hide controls for video
        <% if (file.extensionType === 'video') { %>
        let hideControlsTimeout;
        const controlsOverlay = document.querySelector('.controls-overlay');
        const viewerContent = document.querySelector('.viewer-content');

        function showControls() {
            controlsOverlay.style.opacity = '1';
            clearTimeout(hideControlsTimeout);
            hideControlsTimeout = setTimeout(() => {
                controlsOverlay.style.opacity = '0';
            }, 3000);
        }

        viewerContent.addEventListener('mousemove', showControls);
        showControls();
        <% } %>
    </script>
</body>
</html>

